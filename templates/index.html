<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† EmlakIQ | AI Emlak Fiyat Tahmini</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --accent: #f72585;
            --success: #4cc9f0;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Header */
        .header {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            grid-column: 1 / -1;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary);
        }
    .logo-text {
    font-family: 'Montserrat', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text; /* Webkit i√ßin */
    -webkit-text-fill-color: transparent; /* Textin gradient ile g√∂r√ºnmesini saƒülar */
    background-clip: text; /* Diƒüer tarayƒ±cƒ±lar i√ßin */
    color: transparent; /* Fallback */
}


        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: var(--light);
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        /* Form Card */
        .form-card {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }
        
        .card-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--primary);
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--accent);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .required::after {
            content: " *";
            color: var(--accent);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .feature-item {
            position: relative;
        }
        
        .feature-item input {
            display: none;
        }
        
        .feature-label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--light-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .feature-label:hover {
            border-color: var(--primary);
            background: white;
        }
        
        .feature-item input:checked + .feature-label {
            background: rgba(67, 97, 238, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .feature-icon {
            font-size: 1.1rem;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }
        
        /* Result Card */
        .result-card {
            background: linear-gradient(135deg, var(--dark) 0%, #1a1b2e 100%);
            color: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .result-icon {
            font-size: 3rem;
            color: var(--success);
            margin-bottom: 15px;
        }
        
        .result-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .result-subtitle {
            opacity: 0.8;
            font-size: 0.95rem;
        }
        
        .prediction-display {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            margin: 25px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }
        
        .prediction-label {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        .prediction-value {
    font-size: 3rem;
    font-weight: 700;
    background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
    -webkit-background-clip: text; /* Chrome, Safari i√ßin */
    -webkit-text-fill-color: transparent; /* Chrome, Safari i√ßin */
    background-clip: text; /* Firefox ve diƒüerleri i√ßin */
    color: transparent; /* Fallback */
    margin: 15px 0;
}

 
        
        .prediction-details {
            text-align: left;
            margin-top: 20px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Loader */
        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loader-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-icon {
            font-size: 1.5rem;
        }
        
        .notification-success .notification-icon {
            color: var(--success);
        }
        
        .notification-error .notification-icon {
            color: var(--accent);
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        /* Progress Bar */
        .progress-container {
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 6px;
            background: var(--light-gray);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-home logo-icon"></i>
                <div class="logo-text">EmlakIQ</div>
            </div>
            <p style="color: var(--gray); margin-bottom: 15px;">
                ƒ∞stanbul'da krediye uygun konutlar i√ßin AI destekli fiyat tahmini
            </p>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="districtCount">{{ districts|length }}</div>
                    <div class="stat-label">ƒ∞l√ße</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">%94.2</div>
                    <div class="stat-label">Doƒüruluk</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">&lt;1sn</div>
                    <div class="stat-label">Tahmin S√ºresi</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">200+</div>
                    <div class="stat-label">√ñzellik</div>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="form-card">
            <h2 class="card-title">
                <i class="fas fa-edit"></i>
                Konut Bilgileri
            </h2>
            
            <form id="predictionForm">
                <!-- Location -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Konum
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="district" class="required">ƒ∞l√ße</label>
                            <select id="district" name="District" required>
                                <option value="">Se√ßiniz</option>
                                {% for district in districts %}
                                <option value="{{ district }}">{{ district }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Mahalle-->
                        <div class="form-group">
                            <label for="neighborhood">Mahalle</label>
                            <select id="neighborhood" name="Neighborhood">
                                <option value="">√ñnce il√ße se√ßin</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Basic Features -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-home"></i>
                        Temel √ñzellikler
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="gross_area" class="required">Br√ºt Alan (m¬≤)</label>
                            <input type="number" id="gross_area" name="gross_area" value="100" min="30" max="500" required>
                        </div>
                        <div class="form-group">
                            <label for="net_area" class="required">Net Alan (m¬≤)</label>
                            <input type="number" id="net_area" name="net_area" value="80" min="20" max="450" required>
                        </div>
                        <div class="form-group">
                            <label for="room_count" class="required">Oda Sayƒ±sƒ±</label>
                            <select id="room_count" name="room_count" required>
                                <option value="1">1+0</option>
                                <option value="2">1+1</option>
                                <option value="3" selected>2+1</option>
                                <option value="4">3+1</option>
                                <option value="5">4+1</option>
                                <option value="6">4+2</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="building_age" class="required">Bina Ya≈üƒ±</label>
                            <select id="building_age" name="building_age" required>
                                <option value="">Se√ßiniz</option>
                                {% for age in building_ages %}
                                <option value="{{ age }}">{{ age }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="floor_count" class="required">Kat Sayƒ±sƒ±</label>
                            <input type="number" id="floor_count" name="floor_count" value="5" min="1" max="50" required>
                        </div>
                        <div class="form-group">
                            <label for="bathroom_count" class="required">Banyo Sayƒ±sƒ±</label>
                            <select id="bathroom_count" name="bathroom_count" required>
                                <option value="1">1</option>
                                <option value="2" selected>2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Additional Features -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-cogs"></i>
                        Ek √ñzellikler
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="heating">Isƒ±tma</label>
                            <select id="heating" name="heating">
                                <option value="">Se√ßiniz</option>
                                {% for heating in heating_types %}
                                <option value="{{ heating }}">{{ heating }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="floor_location">Bulunduƒüu Kat</label>
                            <select id="floor_location" name="floor_location">
                                <option value="">Se√ßiniz</option>
                                {% for location in floor_locations %}
                                <option value="{{ location }}">{{ location }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="using_status">Kullanƒ±m Durumu</label>
                            <select id="using_status" name="using_status">
                                <option value="">Se√ßiniz</option>
                                {% for status in using_status %}
                                <option value="{{ status }}">{{ status }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="from_who">ƒ∞lan Kaynaƒüƒ±</label>
                            <select id="from_who" name="from_who">
                                <option value="">Se√ßiniz</option>
                                {% for source in from_who %}
                                <option value="{{ source }}">{{ source }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Features Checkboxes -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-star"></i>
                        Konut √ñzellikleri
                    </h3>
                    <div class="features-grid">
                        <div class="feature-item">
                            <input type="checkbox" id="balcony" name="Balcony" checked>
                            <label for="balcony" class="feature-label">
                                <i class="fas fa-balance-scale feature-icon"></i>
                                <span>Balkon</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="elevator" name="Elevator" checked>
                            <label for="elevator" class="feature-label">
                                <i class="fas fa-elevator feature-icon"></i>
                                <span>Asans√∂r</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="parking" name="Parking Lot" checked>
                            <label for="parking" class="feature-label">
                                <i class="fas fa-parking feature-icon"></i>
                                <span>Otopark</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="security" name="Security">
                            <label for="security" class="feature-label">
                                <i class="fas fa-shield-alt feature-icon"></i>
                                <span>G√ºvenlik</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="pool" name="Swimming Pool (Open)">
                            <label for="pool" class="feature-label">
                                <i class="fas fa-swimming-pool feature-icon"></i>
                                <span>Havuz</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="air_conditioning" name="Air conditioning">
                            <label for="air_conditioning" class="feature-label">
                                <i class="fas fa-snowflake feature-icon"></i>
                                <span>Klima</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="furnished" name="Furnished">
                            <label for="furnished" class="feature-label">
                                <i class="fas fa-couch feature-icon"></i>
                                <span>Mobilyalƒ±</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="available_for_loan" name="Available for Loan" checked>
                            <label for="available_for_loan" class="feature-label">
                                <i class="fas fa-hand-holding-usd feature-icon"></i>
                                <span>Kredi Uygun</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-container">
                    <label>Form Tamamlanma Durumu</label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="loader" id="loader">
                    <div class="loader-spinner"></div>
                    <p>AI tahmini yapƒ±lƒ±yor...</p>
                </div>
                
                <button type="submit" class="btn-submit" id="submitBtn">
                    <i class="fas fa-calculator"></i>
                    Fiyat Tahmini Yap
                </button>
            </form>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-header">
                <div class="result-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h2 class="result-title">TAHMƒ∞N SONUCU</h2>
                <p class="result-subtitle">AI destekli ger√ßek zamanlƒ± analiz</p>
            </div>
            
            <!-- Prediction Result -->
            <div class="prediction-display" id="predictionDisplay">
                <p class="prediction-label">Tahmini Satƒ±≈ü Fiyatƒ±</p>
                <div class="prediction-value" id="predictionValue">-</div>
                <p class="prediction-label" id="predictionDescription"></p>
                
                <!-- Prediction Details -->
                <div class="prediction-details" id="predictionDetails">
                    <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">Girilen √ñzellikler</h3>
                    <!-- Details will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Empty State -->
            <div id="emptyState">
                <div style="text-align: center; opacity: 0.7; padding: 3rem 1rem;">
                    <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <h3 style="margin-bottom: 0.5rem;">Hen√ºz Tahmin Yapƒ±lmadƒ±</h3>
                    <p>Sol taraftaki formu doldurarak konutunuzun tahmini deƒüerini √∂ƒürenebilirsiniz.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="notification-content">
            <strong id="notificationTitle">Ba≈üarƒ±lƒ±!</strong>
            <p id="notificationMessage">Tahmin ba≈üarƒ±yla tamamlandƒ±.</p>
        </div>
        <button class="notification-close" id="notificationClose">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- JavaScript -->
    <script>
        // DOM Elements
        const form = document.getElementById('predictionForm');
        const districtSelect = document.getElementById('district');
        const neighborhoodSelect = document.getElementById('neighborhood');
        const loader = document.getElementById('loader');
        const submitBtn = document.getElementById('submitBtn');
        const predictionDisplay = document.getElementById('predictionDisplay');
        const predictionValue = document.getElementById('predictionValue');
        const predictionDescription = document.getElementById('predictionDescription');
        const predictionDetails = document.getElementById('predictionDetails');
        const emptyState = document.getElementById('emptyState');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationClose = document.getElementById('notificationClose');
        const progressFill = document.getElementById('progressFill');

        // Form validation and progress tracking
        const requiredFields = ['district', 'gross_area', 'net_area', 'room_count', 
                               'building_age', 'floor_count', 'bathroom_count'];

        // Update progress bar
        function updateProgress() {
            let filled = 0;
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                if (element && element.value && element.value.trim() !== '') {
                    filled++;
                }
            });
            
            // Check checkboxes
            const checkboxes = document.querySelectorAll('.feature-checkbox input[type="checkbox"]:checked');
            filled += Math.min(checkboxes.length, 4) * 0.5; // Max 2 points from checkboxes
            
            const progress = Math.min((filled / (requiredFields.length + 2)) * 100, 100);
            progressFill.style.width = `${progress}%`;
        }

        // Initialize progress bar
        document.addEventListener('DOMContentLoaded', updateProgress);

        // Update progress on any form change
        form.addEventListener('input', updateProgress);
        form.addEventListener('change', updateProgress);

        // MAHALLE Y√úKLEME FONKSƒ∞YONU
        async function loadNeighborhoods(district) {
            console.log(`üéØ ƒ∞l√ße se√ßildi: ${district}`);
            
            if (!district) {
                neighborhoodSelect.innerHTML = '<option value="">√ñnce il√ße se√ßin</option>';
                return;
            }
            
            neighborhoodSelect.innerHTML = '<option value="">Y√ºkleniyor...</option>';
            neighborhoodSelect.disabled = true;
            
            try {
                console.log(`üîç Mahalleler isteniyor: ${district}`);
                const response = await fetch(`/neighborhoods/${encodeURIComponent(district)}`);
                const data = await response.json();
                
                console.log(`üìä API yanƒ±tƒ±:`, data);
                
                if (data.success && data.neighborhoods && data.neighborhoods.length > 0) {
                    neighborhoodSelect.innerHTML = '<option value="">Mahalle Se√ßin</option>';
                    data.neighborhoods.forEach(neighborhood => {
                        const option = document.createElement('option');
                        option.value = neighborhood;
                        option.textContent = neighborhood;
                        neighborhoodSelect.appendChild(option);
                    });
                    
                    console.log(`‚úÖ ${data.count} mahalle y√ºklendi:`, data.neighborhoods);
                    
                    // Ba≈üarƒ± bildirimi
                    showNotification('Mahalleler Y√ºklendi', 
                                   `${district} i√ßin ${data.count} mahalle bulundu.`, 
                                   'success');
                } else {
                    console.warn(`‚ö†Ô∏è  Mahalle bulunamadƒ± veya bo≈ü:`, data);
                    neighborhoodSelect.innerHTML = `
                        <option value="">Mahalle bulunamadƒ±</option>
                        <option value="Merkez">Merkez</option>
                        <option value="Yeni Mahalle">Yeni Mahalle</option>
                    `;
                    
                    showNotification('Uyarƒ±', 
                                   `${district} i√ßin mahalle bulunamadƒ±.`, 
                                   'warning');
                }
                
                neighborhoodSelect.disabled = false;
                
            } catch (error) {
                console.error('‚ùå Mahalle y√ºkleme hatasƒ±:', error);
                neighborhoodSelect.innerHTML = `
                    <option value="">Hata olu≈ütu</option>
                    <option value="Merkez">Merkez</option>
                `;
                
                showNotification('Hata', 
                               'Mahalleler y√ºklenirken bir hata olu≈ütu.', 
                               'error');
            }
            
            updateProgress();
        }

        // ƒ∞l√ße deƒüi≈ütiƒüinde mahalleleri y√ºkle
        districtSelect.addEventListener('change', function() {
            loadNeighborhoods(this.value);
        });

        // Show notification
        function showNotification(title, message, type = 'success') {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // Set icon based on type
            const icon = notification.querySelector('.notification-icon i');
            icon.className = type === 'success' ? 'fas fa-check-circle' :
                           type === 'error' ? 'fas fa-exclamation-circle' :
                           'fas fa-info-circle';
            
            // Show notification
            notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Close notification
        notificationClose.addEventListener('click', () => {
            notification.classList.remove('show');
        });

        // Format price
        function formatPrice(price) {
            if (price >= 1000000) {
                return `${(price / 1000000).toFixed(2)} Milyon TL`;
            } else if (price >= 1000) {
                return `${(price / 1000).toFixed(0)} Bin TL`;
            } else {
                return `${price.toLocaleString('tr-TR')} TL`;
            }
        }

        // Create detail item
        function createDetailItem(label, value) {
            const div = document.createElement('div');
            div.className = 'detail-item';
            div.innerHTML = `
                <span>${label}:</span>
                <span>${value}</span>
            `;
            return div;
        }

        // Form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate required fields
            let valid = true;
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                if (element && (!element.value || element.value.trim() === '')) {
                    element.style.borderColor = 'var(--accent)';
                    valid = false;
                } else if (element) {
                    element.style.borderColor = '';
                }
            });
            
            if (!valid) {
                showNotification('Eksik Bilgi', 'L√ºtfen t√ºm zorunlu alanlarƒ± doldurun.', 'error');
                return;
            }
            
            // Show loader
            loader.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Tahmin Yapƒ±lƒ±yor...';
            
            try {
                // Collect form data
                const formData = new FormData(this);
                
                // Add checkbox values
                const checkboxes = this.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        formData.append(checkbox.name, 'on');
                    }
                });
                
                // Debug i√ßin form verilerini logla
                console.log('üì§ Form verileri g√∂nderiliyor...');
                for (let pair of formData.entries()) {
                    console.log(`   ${pair[0]}: ${pair[1]}`);
                }
                
                // Send request
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                console.log('üì• API yanƒ±tƒ±:', data);
                
                if (data.success) {
                    // Hide empty state, show prediction
                    emptyState.style.display = 'none';
                    predictionDisplay.style.display = 'block';
                    
                    // Animation i√ßin
                    predictionValue.style.opacity = '0';
                    predictionValue.style.transform = 'translateY(20px)';
                    
                    // Update prediction value
                    predictionValue.textContent = data.prediction;
                    
                    // Add description based on price
                    const price = data.prediction_raw;
                    let description = '';
                    let icon = '';
                    if (price > 3000000) {
                        description = 'üíé L√ºks Segment';
                        icon = 'fa-gem';
                    } else if (price > 1500000) {
                        description = '‚≠ê Orta-√úst Segment';
                        icon = 'fa-star';
                    } else if (price > 800000) {
                        description = 'üè† Orta Segment';
                        icon = 'fa-home';
                    } else {
                        description = 'üí∞ Uygun Fiyatlƒ±';
                        icon = 'fa-coins';
                    }
                    predictionDescription.innerHTML = `<i class="fas ${icon}"></i> ${description}`;
                    
                    // Update details
                    predictionDetails.innerHTML = '';
                    const details = [
                        { label: 'ƒ∞l√ße', value: districtSelect.options[districtSelect.selectedIndex].text },
                        { label: 'Mahalle', value: neighborhoodSelect.value || 'Belirtilmedi' },
                        { label: 'Br√ºt Alan', value: document.getElementById('gross_area').value + ' m¬≤' },
                        { label: 'Net Alan', value: document.getElementById('net_area').value + ' m¬≤' },
                        { label: 'Oda Sayƒ±sƒ±', value: document.getElementById('room_count').options[document.getElementById('room_count').selectedIndex].text },
                        { label: 'Bina Ya≈üƒ±', value: document.getElementById('building_age').value },
                        { label: 'Kullanƒ±lan √ñzellik', value: `${data.used_features || 'N/A'}/${data.total_features || 'N/A'}` }
                    ];
                    
                    details.forEach(detail => {
                        predictionDetails.appendChild(createDetailItem(detail.label, detail.value));
                    });
                    
                    // Animation
                    setTimeout(() => {
                        predictionValue.style.opacity = '1';
                        predictionValue.style.transform = 'translateY(0)';
                        predictionValue.style.transition = 'all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)';
                    }, 100);
                    
                    // Success notification
                    showNotification('Tahmin Tamamlandƒ±!', 
                                   `Konutun tahmini deƒüeri: ${data.prediction}`, 
                                   'success');
                } else {
                    showNotification('Tahmin Hatasƒ±', 
                                   data.error || 'Tahmin yapƒ±lƒ±rken bir hata olu≈ütu.', 
                                   'error');
                }
            } catch (error) {
                console.error('Form submission error:', error);
                showNotification('Baƒülantƒ± Hatasƒ±', 
                               'Sunucuya baƒülanƒ±rken bir hata olu≈ütu. L√ºtfen tekrar deneyin.', 
                               'error');
            } finally {
                // Hide loader
                loader.style.display = 'none';
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-calculator"></i> Fiyat Tahmini Yap';
            }
        });

document.addEventListener('DOMContentLoaded', function() {
    console.log("‚úÖ Sayfa y√ºklendi!");
    console.log(`üìä ƒ∞l√ße sayƒ±sƒ±: ${document.getElementById('districtCount').textContent}`);

    const districtSelect = document.getElementById('district');

    // Default olarak ilk il√ßeyi se√ß ve mahallelerini y√ºkle
    if (districtSelect.options.length > 1) {
        const firstDistrict = districtSelect.options[1].value;
        districtSelect.value = firstDistrict;
        loadNeighborhoods(firstDistrict);
    }
});